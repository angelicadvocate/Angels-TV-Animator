<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë                   ANGELS-TV-ANIMATOR ‚Äî 5-DAY WEATHER FORECAST              ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë                                                                            ‚ïë
    ‚ïë  Displays a 5-day weather forecast on your Smart TV using the free         ‚ïë
    ‚ïë  Open-Meteo API (https://open-meteo.com). No API key required!             ‚ïë
    ‚ïë                                                                            ‚ïë
    ‚ïë  HOW TO SET YOUR LOCATION:                                                 ‚ïë
    ‚ïë  Find the WEATHER_LOCATION variable in the <script> section near the       ‚ïë
    ‚ïë  bottom of this file and change it to your city name:                      ‚ïë
    ‚ïë                                                                            ‚ïë
    ‚ïë      const WEATHER_LOCATION = "New York";                                  ‚ïë
    ‚ïë                                                                            ‚ïë
    ‚ïë  EXAMPLES:                                                                 ‚ïë
    ‚ïë      "Los Angeles"           ‚Äî city name                                   ‚ïë
    ‚ïë      "London"                ‚Äî international cities work too               ‚ïë
    ‚ïë      "Dallas, Texas"         ‚Äî city + state for precision                  ‚ïë
    ‚ïë      "Tokyo"                 ‚Äî anywhere in the world                       ‚ïë
    ‚ïë                                                                            ‚ïë
    ‚ïë  HOW TO CHANGE UNITS:                                                      ‚ïë
    ‚ïë  Find the WEATHER_UNITS variable and change it:                            ‚ïë
    ‚ïë      "fahrenheit"  ‚Äî temperatures in ¬∞F, wind in mph (US default)          ‚ïë
    ‚ïë      "celsius"     ‚Äî temperatures in ¬∞C, wind in km/h (metric)             ‚ïë
    ‚ïë                                                                            ‚ïë
    ‚ïë  DATA SOURCE:                                                              ‚ïë
    ‚ïë  This uses Open-Meteo's free forecast API and geocoding service.           ‚ïë
    ‚ïë  No account or API key is needed. Data refreshes every 30 minutes.         ‚ïë
    ‚ïë  https://open-meteo.com ‚Äî Free for non-commercial use.                     ‚ïë
    ‚ïë                                                                            ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    -->

    <title>5-Day Forecast ‚Äî Angels-TV-Animator</title>

    <!-- REQUIRED ‚Äî Angels-TV-Animator Integration CSS -->
    <link rel="stylesheet" href="/static/css/ata-integration.css">

    <style>
        /* ===== Base Styles ===== */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(160deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #ffffff;
        }

        /* ===== Main Layout ===== */
        .forecast-wrapper {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            box-sizing: border-box;
        }

        /* ===== Header / Current Conditions ===== */
        .forecast-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .location-name {
            font-size: 52px;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
            margin: 0 0 8px 0;
        }

        .current-date {
            font-size: 22px;
            opacity: 0.7;
            font-weight: 300;
            margin: 0;
        }

        .current-temp {
            font-size: 120px;
            font-weight: 200;
            line-height: 1;
            margin: 20px 0 5px 0;
            text-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
        }

        .current-condition {
            font-size: 28px;
            opacity: 0.8;
            font-weight: 300;
        }

        .current-details {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-top: 10px;
            font-size: 18px;
            opacity: 0.6;
        }

        /* ===== 5-Day Forecast Cards ===== */
        .forecast-days {
            display: flex;
            gap: 24px;
            justify-content: center;
            flex-wrap: nowrap;
        }

        .day-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            padding: 28px 32px;
            text-align: center;
            min-width: 180px;
            transition: transform 0.3s ease, background 0.3s ease;
        }

        .day-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.12);
        }

        .day-card.today {
            background: rgba(99, 140, 255, 0.2);
            border-color: rgba(99, 140, 255, 0.4);
        }

        .day-name {
            font-size: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 14px;
            opacity: 0.9;
        }

        .day-icon {
            font-size: 48px;
            margin-bottom: 14px;
            line-height: 1;
        }

        .day-temps {
            display: flex;
            justify-content: center;
            gap: 12px;
            font-size: 22px;
        }

        .temp-high {
            font-weight: 600;
        }

        .temp-low {
            opacity: 0.5;
            font-weight: 300;
        }

        .day-condition {
            font-size: 14px;
            opacity: 0.6;
            margin-top: 10px;
            line-height: 1.3;
        }

        /* ===== Loading & Error States ===== */
        .loading-state,
        .error-state {
            text-align: center;
        }

        .loading-state .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-state p,
        .error-state p {
            font-size: 24px;
            opacity: 0.7;
        }

        .error-state .error-icon {
            font-size: 60px;
            margin-bottom: 10px;
        }

        .error-state .error-detail {
            font-size: 16px;
            opacity: 0.4;
            margin-top: 8px;
        }

        /* ===== Last Updated ===== */
        .last-updated {
            position: fixed;
            bottom: 16px;
            right: 20px;
            font-size: 13px;
            opacity: 0.3;
        }
    </style>
</head>
<body>

    <div class="forecast-wrapper" id="mainElement">
        <!-- Content is rendered by JavaScript below -->
        <div class="loading-state" id="loadingState">
            <div class="spinner"></div>
            <p>Loading forecast...</p>
        </div>
    </div>

    <div class="last-updated" id="lastUpdated"></div>

    <!-- REQUIRED ‚Äî Integration Scripts (DO NOT REMOVE) -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="/static/js/ata-integration.js"></script>

    <script>
        // =====================================================================
        //  ‚òÖ  CHANGE YOUR LOCATION HERE  ‚òÖ
        //
        //  Set this to your city name. Examples:
        //      "New York"
        //      "Los Angeles"
        //      "Dallas, Texas"
        //      "London"
        //      "Tokyo"
        // =====================================================================
        const WEATHER_LOCATION = "New York";

        // =====================================================================
        //  ‚òÖ  CHANGE YOUR UNITS HERE  ‚òÖ
        //
        //      "fahrenheit"  ‚Üí ¬∞F and mph  (US default)
        //      "celsius"     ‚Üí ¬∞C and km/h (metric)
        // =====================================================================
        const WEATHER_UNITS = "fahrenheit";

        // =====================================================================
        //  How often to refresh the forecast (in minutes).
        //  Default is 30 minutes. Open-Meteo updates hourly,
        //  so going below 15 minutes isn't very useful.
        // =====================================================================
        const REFRESH_INTERVAL_MINUTES = 30;


        // ===== Weather code ‚Üí emoji + description mapping =====
        const WEATHER_CODES = {
            0:  { icon: "‚òÄÔ∏è",  desc: "Clear Sky" },
            1:  { icon: "üå§Ô∏è", desc: "Mostly Clear" },
            2:  { icon: "‚õÖ",  desc: "Partly Cloudy" },
            3:  { icon: "‚òÅÔ∏è",  desc: "Overcast" },
            45: { icon: "üå´Ô∏è", desc: "Foggy" },
            48: { icon: "üå´Ô∏è", desc: "Icy Fog" },
            51: { icon: "üå¶Ô∏è", desc: "Light Drizzle" },
            53: { icon: "üå¶Ô∏è", desc: "Drizzle" },
            55: { icon: "üå¶Ô∏è", desc: "Heavy Drizzle" },
            56: { icon: "üåßÔ∏è", desc: "Freezing Drizzle" },
            57: { icon: "üåßÔ∏è", desc: "Heavy Freezing Drizzle" },
            61: { icon: "üåßÔ∏è", desc: "Light Rain" },
            63: { icon: "üåßÔ∏è", desc: "Rain" },
            65: { icon: "üåßÔ∏è", desc: "Heavy Rain" },
            66: { icon: "üåßÔ∏è", desc: "Freezing Rain" },
            67: { icon: "üåßÔ∏è", desc: "Heavy Freezing Rain" },
            71: { icon: "üå®Ô∏è", desc: "Light Snow" },
            73: { icon: "üå®Ô∏è", desc: "Snow" },
            75: { icon: "‚ùÑÔ∏è",  desc: "Heavy Snow" },
            77: { icon: "üå®Ô∏è", desc: "Snow Grains" },
            80: { icon: "üå¶Ô∏è", desc: "Light Showers" },
            81: { icon: "üåßÔ∏è", desc: "Showers" },
            82: { icon: "‚õàÔ∏è",  desc: "Heavy Showers" },
            85: { icon: "üå®Ô∏è", desc: "Light Snow Showers" },
            86: { icon: "‚ùÑÔ∏è",  desc: "Heavy Snow Showers" },
            95: { icon: "‚õàÔ∏è",  desc: "Thunderstorm" },
            96: { icon: "‚õàÔ∏è",  desc: "Thunderstorm + Hail" },
            99: { icon: "‚õàÔ∏è",  desc: "Thunderstorm + Heavy Hail" },
        };

        function getWeatherInfo(code) {
            return WEATHER_CODES[code] || { icon: "üå°Ô∏è", desc: "Unknown" };
        }

        // ===== Geocoding: convert city name ‚Üí lat/lon =====
        async function geocodeLocation(name) {
            const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=en&format=json`;
            const resp = await fetch(url);
            const data = await resp.json();
            if (!data.results || data.results.length === 0) {
                throw new Error(`Location "${name}" not found. Check the WEATHER_LOCATION value.`);
            }
            const loc = data.results[0];
            return {
                lat: loc.latitude,
                lon: loc.longitude,
                name: loc.name,
                region: loc.admin1 || "",
                country: loc.country_code || "",
            };
        }

        // ===== Fetch 5-day forecast from Open-Meteo =====
        async function fetchForecast(lat, lon) {
            const isFahrenheit = WEATHER_UNITS.toLowerCase() === "fahrenheit";
            const tempUnit = isFahrenheit ? "fahrenheit" : "celsius";
            const windUnit = isFahrenheit ? "mph" : "kmh";

            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`
                + `&current=temperature_2m,weather_code,wind_speed_10m,relative_humidity_2m,apparent_temperature`
                + `&daily=weather_code,temperature_2m_max,temperature_2m_min`
                + `&temperature_unit=${tempUnit}&wind_speed_unit=${windUnit}`
                + `&timezone=auto&forecast_days=5`;

            const resp = await fetch(url);
            if (!resp.ok) throw new Error(`API error: ${resp.status}`);
            return await resp.json();
        }

        // ===== Format the display name =====
        function formatLocationDisplay(geo) {
            if (geo.region && geo.country) {
                return geo.country === "US"
                    ? `${geo.name}, ${geo.region}`
                    : `${geo.name}, ${geo.country}`;
            }
            return geo.name;
        }

        // ===== Render the forecast =====
        function renderForecast(geo, data) {
            const wrapper = document.getElementById('mainElement');
            const isFahrenheit = WEATHER_UNITS.toLowerCase() === "fahrenheit";
            const tempSymbol = isFahrenheit ? "¬∞F" : "¬∞C";
            const windLabel = isFahrenheit ? "mph" : "km/h";

            const current = data.current;
            const daily = data.daily;
            const currentWeather = getWeatherInfo(current.weather_code);

            // Format today's date
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', {
                weekday: 'long', month: 'long', day: 'numeric'
            });

            // Day name abbreviations
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            // Build day cards
            let cardsHTML = '';
            for (let i = 0; i < daily.time.length; i++) {
                const date = new Date(daily.time[i] + 'T12:00:00');
                const dayName = i === 0 ? 'Today' : dayNames[date.getDay()];
                const weather = getWeatherInfo(daily.weather_code[i]);
                const high = Math.round(daily.temperature_2m_max[i]);
                const low = Math.round(daily.temperature_2m_min[i]);

                cardsHTML += `
                    <div class="day-card${i === 0 ? ' today' : ''}">
                        <div class="day-name">${dayName}</div>
                        <div class="day-icon">${weather.icon}</div>
                        <div class="day-temps">
                            <span class="temp-high">${high}¬∞</span>
                            <span class="temp-low">${low}¬∞</span>
                        </div>
                        <div class="day-condition">${weather.desc}</div>
                    </div>
                `;
            }

            wrapper.innerHTML = `
                <div class="forecast-header">
                    <h1 class="location-name">${formatLocationDisplay(geo)}</h1>
                    <p class="current-date">${dateStr}</p>
                    <div class="current-temp">${currentWeather.icon} ${Math.round(current.temperature_2m)}¬∞</div>
                    <div class="current-condition">${currentWeather.desc}</div>
                    <div class="current-details">
                        <span>Feels like ${Math.round(current.apparent_temperature)}${tempSymbol}</span>
                        <span>üí® ${Math.round(current.wind_speed_10m)} ${windLabel}</span>
                        <span>üíß ${current.relative_humidity_2m}%</span>
                    </div>
                </div>
                <div class="forecast-days">
                    ${cardsHTML}
                </div>
            `;

            // Update timestamp
            const timeStr = now.toLocaleTimeString('en-US', {
                hour: 'numeric', minute: '2-digit'
            });
            document.getElementById('lastUpdated').textContent = `Updated ${timeStr}`;
        }

        // ===== Show error state =====
        function renderError(message) {
            const wrapper = document.getElementById('mainElement');
            wrapper.innerHTML = `
                <div class="error-state">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <p>${message}</p>
                    <p class="error-detail">Will retry automatically. Check the WEATHER_LOCATION variable in this file.</p>
                </div>
            `;
        }

        // ===== Main load function =====
        async function loadForecast() {
            try {
                const geo = await geocodeLocation(WEATHER_LOCATION);
                const data = await fetchForecast(geo.lat, geo.lon);
                renderForecast(geo, data);
            } catch (err) {
                console.error('Weather forecast error:', err);
                renderError(err.message || 'Failed to load forecast');
            }
        }

        // ===== Initialize =====
        document.addEventListener('DOMContentLoaded', () => {
            // Load forecast immediately
            loadForecast();

            // Refresh on interval
            setInterval(loadForecast, REFRESH_INTERVAL_MINUTES * 60 * 1000);

            // ATA integration
            window.ataIntegration = new ATAIntegration('mainElement');
        });
    </script>

</body>
</html>
